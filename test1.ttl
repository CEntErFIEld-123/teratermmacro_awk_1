# teratermmacro_awk_1
test1.ttl

st = params[2]
go = params[3]

;; ユーザ名入力
inputbox 'ユーザ名の入力をお願いします。' 'ユーザ名の入力' 
USERNAME = inputstr 

;; パスワード入力
passwordbox 'パスワードの入力をお願いします。' 'パスワードの入力' 

;; 接続先ホスト情報入力 
HOSTADDR = 'ip4'
 
;; 接続コマンド組立て 
COMMAND = HOSTADDR 
strconcat COMMAND ':22 /ssh /2 /auth=password /user=' 
strconcat COMMAND USERNAME 
strconcat COMMAND ' /passwd=' 
strconcat COMMAND inputstr
 
;; ログファイル名の設定 
;現在の日時を元にしてログファイル名を生成し、変数LOG_NAMEに格納。
;形式はresult_YYYYMMDD.txt
getdate LOG_NAME 'result_%Y%m%d.txt'

;; ログ保存先指定 
getdir LOGSPATH
FULLPATH = LOGSPATH
strconcat FULLPATH '\result\'
strconcat FULLPATH LOG_NAME
 
;; syslogサーバへ接続 
connect COMMAND
 
;; 接続判定①（接続出来ない場合はメッセージを表示しマクロ終了） 
if result = 0 then 
  messagebox 'キャンセルされました' 'エラー' 
  end 
endif

if result = 1 then 
  messagebox '申し訳ございません。接続できませんでした。' 'エラー' 
  messagebox '未接続の状態です。サーバの状態を確認してください。' 'エラー' 
  end 
endif

;; 接続判定②（接続して10秒以内にプロンプトが表示されない場合もマクロ終了） 
timeout = 7

  wait '$' '#'
if result = 0 then
  messagebox '申し訳ございません。接続できませんでした。' 'エラー'
  messagebox 'ユーザ名やパスワードが間違っている可能性があります。バッチから再実行してください。' 'エラー'   
  end 
endif

;; 情報の取得
;ファイルの移動
sendln 'cd /var/log'

;コマンドの組み立て
unko = 'awk '#$27'{ sub("hogehogeeeeee","",$3); print }'#$27' hogefile | awk '#$27'"'
strconcat unko st
strconcat unko '" < $3 && $3 <= "'
strconcat unko go
strconcat unko '"'#$27''
;strconcat unko '/p" test4 | grep "hoge"'

;; ログ取得開始 
logopen FULLPATH 0 0

sendln unko

wait '$' '#'
sendln 'exit'

exec 'powershell hogepath'

;; ⑪マクロ終了 
end
